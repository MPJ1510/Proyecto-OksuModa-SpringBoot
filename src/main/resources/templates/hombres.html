<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" 
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
  <meta charset="UTF-8">
  <title>Hombres - Colecci√≥n</title>
  <link href="https://fonts.googleapis.com/css?family=Instrument+Sans&display=swap" rel="stylesheet">
  <link rel="stylesheet" type="text/css" th:href="@{/css/hombres.css}">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
</head>

<body>
  <div class="contenedor-principal">
    <!-- Barra superior negra -->
    <div class="barra-superior">
      <div class="contenido-barra">
        <div class="black-bar">
          <a th:href="@{/admin/dashboard}" 
             sec:authorize="hasAnyRole('ADMIN', 'ADMINISTRADOR')" 
             class="btn-admin"
             title="Panel de Control">
            <i class="bi bi-clipboard-fill"></i> 
          </a>
          
          <span sec:authorize="isAuthenticated()" class="usuario-info">
            Hola, <strong sec:authentication="principal.nombre"></strong>
          </span>
        </div>
        
        <span class="texto-envio">Env√≠os gratis desde $150.000</span>
        
        <div class="icon-bar">
          <label for="search-input">
            <i class="fas fa-search"></i>
          </label>
          <input id="search-input" type="text" placeholder="Buscar..." style="display: none;">
          
          <a href="/contactanos">
            <i class="fas fa-user"></i>
          </a>
          
          <div class="linea-blanca"></div>
          
          <!-- Icono del carrito con contador -->
          <a href="/carrito" class="carrito-link">
            <i class="fas fa-shopping-cart"></i>
            <span class="contador-carrito">0</span>
          </a>
        </div>
      </div>
    </div>

    <!-- Navegaci√≥n principal -->
    <div class="navegacion-principal">
      <a th:href="@{/}" class="logo"></a>
      
      <nav class="menu-nav">
        <a href="/hombres" class="link-nav active">Hombres</a>
        <a href="/mujeres" class="link-nav">Mujeres</a>
        <a href="/ninos" class="link-nav">Ni√±os</a>
        <a href="/otros" class="link-nav">Otros</a>
      </nav>
      
      <div class="auth-section">
        <div sec:authorize="!isAuthenticated()">
          <a th:href="@{/login}" class="link-auth">Iniciar sesi√≥n</a>
          <span class="separador-vertical"></span>
          <a th:href="@{/registro}" class="link-auth">Crear una cuenta</a>
        </div>
        
        <div sec:authorize="isAuthenticated()">
          <form th:action="@{/logout}" method="post" style="display: inline;">
            <button type="submit" class="btn-cerrar-sesion">Cerrar Sesi√≥n</button>
          </form>
        </div>
      </div>
    </div>

    <hr class="linea-separadora">

    <!-- Banner hero -->
    <section class="hero-section">
      <div class="hero-content">
        <h1 class="hero-titulo">Colecci√≥n para Hombres</h1>
        <p class="hero-subtitulo">Descubre las √∫ltimas tendencias en moda masculina</p>
      </div>
    </section>

    <!-- Filtros y ordenamiento -->
    <section class="seccion-filtros">
      <div class="contenedor-filtros">
        <div class="grupo-filtros">
          <button class="btn-filtro active">
            <i class="fas fa-th"></i> Todos
          </button>
          <button class="btn-filtro">
            <i class="fas fa-tshirt"></i> Camisetas
          </button>
          <button class="btn-filtro">
            <i class="fas fa-vest"></i> Chaquetas
          </button>
          <button class="btn-filtro">
            <i class="fas fa-socks"></i> Pantalones
          </button>
          <button class="btn-filtro">
            <i class="fas fa-shoe-prints"></i> Calzado
          </button>
          <button class="btn-filtro">
            <i class="fas fa-plus-circle"></i> Accesorios
          </button>
        </div>
        
        <div class="ordenamiento">
          <label for="orden">Ordenar por:</label>
          <select id="orden" class="select-orden">
            <option value="reciente">M√°s reciente</option>
            <option value="precio-asc">Precio: Menor a Mayor</option>
            <option value="precio-desc">Precio: Mayor a Menor</option>
            <option value="popular">M√°s popular</option>
          </select>
        </div>
      </div>
    </section>

    <!-- Grid de productos -->
    <section class="seccion-productos">
      <div class="grid-productos">
        <!-- Producto 1 - IMPORTANTE: data-producto-id debe coincidir con el ID real en tu BD -->
        <div class="tarjeta-producto" data-producto-id="1">
          <div class="imagen-producto">
            <span class="etiqueta-nuevo">NUEVO</span>
            <img src="/im√°genes/producto-hombre-1.jpg" alt="Producto" class="img-principal">
            <img src="/im√°genes/producto-hombre-1-hover.jpg" alt="Producto hover" class="img-hover">
            <div class="acciones-rapidas">
              <button class="btn-accion" title="Ver detalles">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn-accion btn-agregar-carrito" title="Agregar al carrito">
                <i class="fas fa-shopping-bag"></i>
              </button>
              <button class="btn-accion" title="Favorito">
                <i class="far fa-heart"></i>
              </button>
            </div>
          </div>
          <div class="info-producto">
            <h3 class="nombre-producto">Camisa Casual Slim Fit</h3>
            <p class="categoria-producto">Camisas</p>
            <div class="precio-producto">
              <span class="precio-actual">$89.900</span>
            </div>
            <div class="colores-disponibles">
              <span class="color-muestra" style="background: #1a1a1a;" data-color="Negro"></span>
              <span class="color-muestra" style="background: #ffffff; border: 1px solid #ddd;" data-color="Blanco"></span>
              <span class="color-muestra" style="background: #2c5aa0;" data-color="Azul"></span>
            </div>
          </div>
        </div>

        <!-- Producto 2 -->
        <div class="tarjeta-producto" data-producto-id="2">
          <div class="imagen-producto">
            <span class="etiqueta-descuento">-30%</span>
            <img src="/im√°genes/producto-hombre-2.jpg" alt="Producto" class="img-principal">
            <img src="/im√°genes/producto-hombre-2-hover.jpg" alt="Producto hover" class="img-hover">
            <div class="acciones-rapidas">
              <button class="btn-accion" title="Ver detalles">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn-accion btn-agregar-carrito" title="Agregar al carrito">
                <i class="fas fa-shopping-bag"></i>
              </button>
              <button class="btn-accion" title="Favorito">
                <i class="far fa-heart"></i>
              </button>
            </div>
          </div>
          <div class="info-producto">
            <h3 class="nombre-producto">Jeans Regular Fit</h3>
            <p class="categoria-producto">Pantalones</p>
            <div class="precio-producto">
              <span class="precio-anterior">$149.900</span>
              <span class="precio-actual">$104.930</span>
            </div>
            <div class="colores-disponibles">
              <span class="color-muestra" style="background: #1c3a57;" data-color="Azul Oscuro"></span>
              <span class="color-muestra" style="background: #2a2a2a;" data-color="Negro"></span>
            </div>
          </div>
        </div>

        <!-- Producto 3 -->
        <div class="tarjeta-producto" data-producto-id="3">
          <div class="imagen-producto">
            <img src="/im√°genes/producto-hombre-3.jpg" alt="Producto" class="img-principal">
            <img src="/im√°genes/producto-hombre-3-hover.jpg" alt="Producto hover" class="img-hover">
            <div class="acciones-rapidas">
              <button class="btn-accion" title="Ver detalles">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn-accion btn-agregar-carrito" title="Agregar al carrito">
                <i class="fas fa-shopping-bag"></i>
              </button>
              <button class="btn-accion" title="Favorito">
                <i class="far fa-heart"></i>
              </button>
            </div>
          </div>
          <div class="info-producto">
            <h3 class="nombre-producto">Chaqueta Bomber</h3>
            <p class="categoria-producto">Chaquetas</p>
            <div class="precio-producto">
              <span class="precio-actual">$189.900</span>
            </div>
            <div class="colores-disponibles">
              <span class="color-muestra" style="background: #1a1a1a;" data-color="Negro"></span>
              <span class="color-muestra" style="background: #4a4a4a;" data-color="Gris"></span>
              <span class="color-muestra" style="background: #8b4513;" data-color="Caf√©"></span>
            </div>
          </div>
        </div>

        <!-- Producto 4 -->
        <div class="tarjeta-producto" data-producto-id="4">
          <div class="imagen-producto">
            <span class="etiqueta-nuevo">NUEVO</span>
            <img src="/im√°genes/producto-hombre-4.jpg" alt="Producto" class="img-principal">
            <img src="/im√°genes/producto-hombre-4-hover.jpg" alt="Producto hover" class="img-hover">
            <div class="acciones-rapidas">
              <button class="btn-accion" title="Ver detalles">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn-accion btn-agregar-carrito" title="Agregar al carrito">
                <i class="fas fa-shopping-bag"></i>
              </button>
              <button class="btn-accion" title="Favorito">
                <i class="far fa-heart"></i>
              </button>
            </div>
          </div>
          <div class="info-producto">
            <h3 class="nombre-producto">Polo Manga Corta</h3>
            <p class="categoria-producto">Camisetas</p>
            <div class="precio-producto">
              <span class="precio-actual">$69.900</span>
            </div>
            <div class="colores-disponibles">
              <span class="color-muestra" style="background: #ffffff; border: 1px solid #ddd;" data-color="Blanco"></span>
              <span class="color-muestra" style="background: #1a1a1a;" data-color="Negro"></span>
              <span class="color-muestra" style="background: #c41e3a;" data-color="Rojo"></span>
              <span class="color-muestra" style="background: #003366;" data-color="Azul Marino"></span>
            </div>
          </div>
        </div>

        <!-- Producto 5 -->
        <div class="tarjeta-producto" data-producto-id="5">
          <div class="imagen-producto">
            <img src="/im√°genes/producto-hombre-5.jpg" alt="Producto" class="img-principal">
            <img src="/im√°genes/producto-hombre-5-hover.jpg" alt="Producto hover" class="img-hover">
            <div class="acciones-rapidas">
              <button class="btn-accion" title="Ver detalles">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn-accion btn-agregar-carrito" title="Agregar al carrito">
                <i class="fas fa-shopping-bag"></i>
              </button>
              <button class="btn-accion" title="Favorito">
                <i class="far fa-heart"></i>
              </button>
            </div>
          </div>
          <div class="info-producto">
            <h3 class="nombre-producto">Zapatillas Deportivas</h3>
            <p class="categoria-producto">Calzado</p>
            <div class="precio-producto">
              <span class="precio-actual">$229.900</span>
            </div>
            <div class="colores-disponibles">
              <span class="color-muestra" style="background: #ffffff; border: 1px solid #ddd;" data-color="Blanco"></span>
              <span class="color-muestra" style="background: #1a1a1a;" data-color="Negro"></span>
            </div>
          </div>
        </div>

        <!-- Producto 6 -->
        <div class="tarjeta-producto" data-producto-id="6">
          <div class="imagen-producto">
            <span class="etiqueta-descuento">-20%</span>
            <img src="/im√°genes/producto-hombre-6.jpg" alt="Producto" class="img-principal">
            <img src="/im√°genes/producto-hombre-6-hover.jpg" alt="Producto hover" class="img-hover">
            <div class="acciones-rapidas">
              <button class="btn-accion" title="Ver detalles">
                <i class="fas fa-eye"></i>
              </button>
              <button class="btn-accion btn-agregar-carrito" title="Agregar al carrito">
                <i class="fas fa-shopping-bag"></i>
              </button>
              <button class="btn-accion" title="Favorito">
                <i class="far fa-heart"></i>
              </button>
            </div>
          </div>
          <div class="info-producto">
            <h3 class="nombre-producto">Sudadera con Capucha</h3>
            <p class="categoria-producto">Sudaderas</p>
            <div class="precio-producto">
              <span class="precio-anterior">$119.900</span>
              <span class="precio-actual">$95.920</span>
            </div>
            <div class="colores-disponibles">
              <span class="color-muestra" style="background: #4a4a4a;" data-color="Gris"></span>
              <span class="color-muestra" style="background: #1a1a1a;" data-color="Negro"></span>
              <span class="color-muestra" style="background: #003d7a;" data-color="Azul"></span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Paginaci√≥n -->
    <div class="paginacion">
      <button class="btn-paginacion" disabled>
        <i class="fas fa-chevron-left"></i>
      </button>
      <button class="btn-paginacion active">1</button>
      <button class="btn-paginacion">2</button>
      <button class="btn-paginacion">3</button>
      <button class="btn-paginacion">...</button>
      <button class="btn-paginacion">10</button>
      <button class="btn-paginacion">
        <i class="fas fa-chevron-right"></i>
      </button>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <div class="contenido-footer">
        <div class="columna-footer">
          <h4>Acerca de</h4>
          <ul>
            <li><a href="#">Nuestra historia</a></li>
            <li><a href="#">Trabaja con nosotros</a></li>
            <li><a href="#">Sostenibilidad</a></li>
          </ul>
        </div>
        <div class="columna-footer">
          <h4>Ayuda</h4>
          <ul>
            <li><a href="#">Env√≠os</a></li>
            <li><a href="#">Devoluciones</a></li>
            <li><a href="#">Gu√≠a de tallas</a></li>
          </ul>
        </div>
        <div class="columna-footer">
          <h4>S√≠guenos</h4>
          <div class="redes-sociales">
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-twitter"></i></a>
          </div>
        </div>
      </div>
      <div class="copyright">
        <p>&copy; 2025 Tu Tienda. Todos los derechos reservados.</p>
      </div>
    </footer>
  </div>

  <!-- ========================================== -->
  <!-- JAVASCRIPT PARA EL CARRITO DE COMPRAS -->
  <!-- ========================================== -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      
      // Actualizar contador del carrito al cargar la p√°gina
      actualizarContadorCarrito();
      
      // ==========================================
      // AGREGAR AL CARRITO
      // ==========================================
      document.querySelectorAll('.btn-agregar-carrito').forEach(boton => {
        boton.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          // Obtener la tarjeta del producto
          const tarjeta = this.closest('.tarjeta-producto');
          
          // Obtener el ID del producto (desde data-producto-id)
          const productoId = tarjeta.dataset.productoId;
          const nombre = tarjeta.querySelector('.nombre-producto').textContent.trim();
          
          console.log('üõí Agregando al carrito - Producto ID:', productoId, '- Nombre:', nombre);
          
          // Llamar funci√≥n para agregar al carrito
          agregarAlCarrito(productoId, 1, null, null);
        });
      });
      
      // ==========================================
      // VER DETALLES
      // ==========================================
      document.querySelectorAll('.btn-accion[title="Ver detalles"]').forEach(boton => {
        boton.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          const tarjeta = this.closest('.tarjeta-producto');
          const nombre = tarjeta.querySelector('.nombre-producto').textContent.trim();
          
          alert('Ver detalles de: ' + nombre);
        });
      });
      
      // ==========================================
      // FAVORITOS
      // ==========================================
      document.querySelectorAll('.btn-accion[title="Favorito"]').forEach(boton => {
        boton.addEventListener('click', function(e) {
          e.preventDefault();
          e.stopPropagation();
          
          const icono = this.querySelector('i');
          
          if (icono.classList.contains('far')) {
            icono.classList.remove('far');
            icono.classList.add('fas');
            this.style.color = '#EB0029';
            mostrarNotificacion('Agregado a favoritos ‚ù§Ô∏è', 'success');
          } else {
            icono.classList.remove('fas');
            icono.classList.add('far');
            this.style.color = '';
            mostrarNotificacion('Eliminado de favoritos', 'info');
          }
        });
      });
      
      // ==========================================
      // B√öSQUEDA
      // ==========================================
      const searchIcon = document.querySelector(".fa-search");
      const searchInput = document.getElementById("search-input");
      
      if (searchIcon && searchInput) {
        searchIcon.addEventListener("click", () => {
          if (searchInput.style.display === "none" || searchInput.style.display === "") {
            searchInput.style.display = "inline-block";
            searchInput.focus();
          } else {
            searchInput.style.display = "none";
          }
        });
      }
      
      // ==========================================
      // ANIMACIONES DE TARJETAS
      // ==========================================
      document.querySelectorAll('.tarjeta-producto').forEach(card => {
        card.addEventListener('mouseenter', function() {
          this.style.transform = 'translateY(-5px)';
        });
        
        card.addEventListener('mouseleave', function() {
          this.style.transform = 'translateY(0)';
        });
      });
    });
    
    // ==========================================
    // FUNCI√ìN: AGREGAR AL CARRITO
    // ==========================================
    function agregarAlCarrito(productoId, cantidad = 1, talla = null, color = null) {
      // Crear FormData
      const formData = new FormData();
      formData.append('productoId', productoId);
      formData.append('cantidad', cantidad);
      if (talla) formData.append('talla', talla);
      if (color) formData.append('color', color);
      
      console.log('üì§ Enviando al servidor:', {productoId, cantidad, talla, color});
      
      // Mostrar notificaci√≥n de cargando
      mostrarNotificacion('Agregando al carrito...', 'info');
      
      // Hacer petici√≥n AJAX
      fetch('/carrito/agregar', {
        method: 'POST',
        body: formData
      })
      .then(response => response.json())
      .then(data => {
        console.log('‚úÖ Respuesta del servidor:', data);
        
        if (data.success) {
          mostrarNotificacion('¬°Producto agregado al carrito! üõí', 'success');
          actualizarContadorCarrito();
          animarIconoCarrito();
        } else {
          mostrarNotificacion(data.message || 'Error al agregar al carrito', 'error');
        }
      })
      .catch(error => {
        console.error('‚ùå Error:', error);
        mostrarNotificacion('Error de conexi√≥n. Intenta de nuevo.', 'error');
      });
    }
    
    // ==========================================
    // FUNCI√ìN: ACTUALIZAR CONTADOR CARRITO
    // ==========================================
    function actualizarContadorCarrito() {
      fetch('/carrito/cantidad')
        .then(response => response.json())
        .then(data => {
          const contador = document.querySelector('.contador-carrito');
          if (contador) {
            const cantidad = data.cantidadItems || 0;
            contador.textContent = cantidad;
            
            if (cantidad > 0) {
              contador.style.display = 'flex';
            } else {
              contador.style.display = 'none';
            }
          }
        })
        .catch(error => console.error('Error al actualizar contador:', error));
    }
    
    // ==========================================
    // FUNCI√ìN: ANIMAR ICONO CARRITO
    // ==========================================
    function animarIconoCarrito() {
      const iconoCarrito = document.querySelector('.fa-shopping-cart');
      if (iconoCarrito) {
        iconoCarrito.style.transition = 'transform 0.3s';
        iconoCarrito.style.transform = 'scale(1.3)';
        
        setTimeout(() => {
          iconoCarrito.style.transform = 'scale(1)';
        }, 300);
      }
    }
    
    // ==========================================
    // FUNCI√ìN: MOSTRAR NOTIFICACI√ìN
    // ==========================================
    function mostrarNotificacion(mensaje, tipo = 'info') {
      // Eliminar notificaci√≥n anterior si existe
      const notifAnterior = document.querySelector('.notificacion-toast');
      if (notifAnterior) {
        notifAnterior.remove();
      }
      
      // Crear notificaci√≥n
      const notif = document.createElement('div');
      notif.className = 'notificacion-toast ' + tipo;
      notif.textContent = mensaje;
      
      // Estilos
      const bgColor = tipo === 'success' ? '#00c853' : tipo === 'error' ? '#EB0029' : '#333';
      notif.style.cssText = `
        position: fixed;
        top: 120px;
        right: 20px;
        background: ${bgColor};
        color: white;
        padding: 15px 25px;
        border-radius: 10px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        z-index: 10000;
        animation: slideIn 0.3s ease;
        font-weight: 600;
        font-size: 0.95rem;
      `;
      
      document.body.appendChild(notif);
      
      // Auto-eliminar despu√©s de 3 segundos
      setTimeout(() => {
        notif.style.animation = 'slideOut 0.3s ease';
        setTimeout(() => notif.remove(), 300);
      }, 3000);
    }
  </script>
</body>
</html>